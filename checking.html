<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Check-In | Qantas Roblox</title>
  <link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="halloween-theme">

<header class="qantas-tab">
  <div><strong>Qantas Roblox</strong></div>
  <nav>
    <a href="index.html">Home</a>
    <a href="#">Manage Booking</a>
    <a href="httpsa://discord.gg/5Z77R4TE">Discord</a>
    <a href="">Menu</a>
  </nav>
</header>

<div class="tab-content active" style="margin-top: 50px;">
  <div class="card" id="checkinCard">
    <h2>Check-In</h2>
    <div id="flightInfo"></div>
    <div id="bookingForm" style="display:none;">
      <label>Discord Name</label>
      <input id="discordName" type="text" placeholder="Enter your Discord name" />
      <label>Seat</label>
      <select id="seatSelect">
        <option>1A</option>
        <option>2B</option>
        <option>3C</option>
        <option>4D</option>
      </select>
      <label>Baggage</label>
      <select id="bagSelect">
        <option>Carry-on only</option>
        <option>Checked bag</option>
        <option>Both</option>
      </select>
      <button id="confirmBtn" onclick="confirmBooking()">Confirm Booking</button>
      <button id="cancelBtn" onclick="cancelBooking()" style="background:#555;">Cancel Booking</button>
    </div>
    <button onclick="goBack()">‚¨ÖÔ∏è Back to Home</button>
  </div>
</div>

<div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.85); color: var(--accent-orange); font-size: 24px; z-index: 9999; justify-content: center; align-items: center; flex-direction: column;">
  <div class="spinner"></div>
  <p>Processing your booking...</p>
</div>

<div id="finalOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.85); color: var(--accent-orange); font-size: 24px; z-index: 9999; justify-content: center; align-items: center; flex-direction: column;"></div>
<div id="errorOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.85); color: var(--accent-orange); font-size: 24px; z-index: 9999; justify-content: center; align-items: center; flex-direction: column;"></div>

<script>
  const flight = JSON.parse(localStorage.getItem("selectedFlight"));
  const info = document.getElementById("flightInfo");
  const form = document.getElementById("bookingForm");
  const refCode = "QR" + Math.floor(Math.random() * 10000);
  let booking = JSON.parse(localStorage.getItem("bookingInfo")) || {};

  localStorage.setItem("bookingInfo", JSON.stringify({ ...booking, referenceCode: refCode, flightCode: flight?.flightCode }));

  if (!flight) {
    info.innerHTML = `<p class="error">‚ùå No flight selected. Please book a flight first.</p>`;
    form.style.display = "none";
  } else {
    info.innerHTML = `
      <p>üõ´ Flight ${flight.flightCode}</p>
      <p>From: ${flight.from}</p>
      <p>To: ${flight.to}</p>
      <p>Date: ${flight.date}</p>
      <p><strong>Reference Code:</strong> ${refCode}</p>
    `;
    form.style.display = "block";

    if (booking.name && booking.flightCode === flight.flightCode) {
      document.getElementById("discordName").value = booking.name;
      document.getElementById("seatSelect").value = booking.seat;
      document.getElementById("bagSelect").value = booking.bag;
      lockForm();
    }
  }

  function lockForm() {
    document.getElementById("discordName").disabled = true;
    document.getElementById("seatSelect").disabled = true;
    document.getElementById("bagSelect").disabled = true;
    document.getElementById("confirmBtn").disabled = true;
    document.getElementById("confirmBtn").innerText = "‚úÖ Already Booked";
  }

  function cancelBooking() {
    localStorage.removeItem("bookingInfo");

    const overlay = document.getElementById("loadingOverlay");
    overlay.innerHTML = `
      <div class="spinner"></div>
      <p>Canceling your booking...</p>
    `;
    overlay.style.display = "flex";

    setTimeout(() => {
      window.location.href = "index.html";
    }, 1400);
  }

  function confirmBooking() {
    const name = document.getElementById("discordName").value.trim();
    const seat = document.getElementById("seatSelect").value;
    const bag = document.getElementById("bagSelect").value;

    if (!name) {
      const error = document.getElementById("errorOverlay");
      error.innerHTML = `
        <div class="xmark">
          <svg viewBox="0 0 52 52">
            <path d="M26 0C11.64 0 0 11.64 0 26s11.64 26 26 26 26-11.64 26-26S40.36 0 26 0zm0 48C13.215 48 4 38.785 4 26S13.215 4 26 4s22 9.215 22 22-9.215 22-22 22zm-6-30l6 6 6-6 2 2-6 6 6 6-2 2-6-6-6 6-2-2 6-6-6-6z"/>
          </svg>
        </div>
        <p>‚ùå Please fill out your Discord name ‚ûï</p>
      `;
      error.style.display = "flex";
      setTimeout(() => error.style.display = "none", 2000);
      return;
    }

    const fullBooking = {
      name,
      seat,
      bag,
      referenceCode: refCode,
      flightCode: flight.flightCode,
      ...flight
    };
    localStorage.setItem("bookingInfo", JSON.stringify(fullBooking));
    lockForm();

    const final = document.getElementById("finalOverlay");
    final.innerHTML = `
      <div class="spinner"></div>
      <p>Processing your booking...</p>
    `;
    final.style.display = "flex";

    setTimeout(() => {
      final.innerHTML = `
        <div class="checkmark">
          <svg viewBox="0 0 52 52">
            <path d="M26 0C11.64 0 0 11.64 0 26s11.64 26 26 26 26-11.64 26-26S40.36 0 26 0zm0 48C13.215 48 4 38.785 4 26S13.215 4 26 4s22 9.215 22 22-9.215 22-22 22zM21 37l-10-10 2-2 8 8 16-16 2 2L21 37z"/>
          </svg>
        </div>
        <p>Booking Confirmed!</p>
        <p>Please fill out the reference sheet with this code ‚ûï</p>
        <p style="font-weight:bold; font-size: 28px;">${refCode}</p>
      `;
      final.style.display = "flex";
    }, 2000);

    setTimeout(() => {
      window.location.href = "index.html";
    }, 5000);
  }

  function goBack() {
    const overlay = document.getElementById("loadingOverlay");
    overlay.innerHTML = `
      <div class="spinner"></div>
      <p>Returning to home page...</p>
    `;
    overlay.style.display = "flex";
    setTimeout(() => {
      window.location.href = "index.html";
    }, 2000);
  }
</script>

</body>
</html>
